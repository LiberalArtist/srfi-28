<!DOCTYPE HTML PUBLIC "-//IETF//DTD HTML//EN">
<html>
  <head>
    <title>SRFI 28: Basic Format Strings</title>    
    <meta name="author" content="Scott G. Miller">                       
    <meta name="description" content="Basic Format Strings">
  </head>
  <body>
    
<H1>Title</H1>

Basic Format Strings        

<H1>Author</H1>

Scott G. Miller        

<H1>Abstract</H1>

This document specifies Format Strings, a method of interpreting a
Scheme string which contains a number of escape sequences that are
replaced with other string data according to the semantics of each
sequence.
    
<H1>Rationale</H1>

Many Scheme systems provide access to a function called
<tt>format.</tt> This function takes as arguments a format string,
an ordinary Scheme string containing zero or more escape
sequences, followed zero or more Scheme values. The procedure
processes the format string and performs string replacement on the
escape sequences according to the rules for each code.  This SRFI
defines a basic version of <tt>format</tt> which should allow
portable code to be written using the function without much (if
any) effort on the part of Scheme implementors.

<H1>Specification</H1> 

<b><tt>format</tt></b>
<tt><i>format-string [obj ...] -&gt; string</i></tt> 

<blockquote>
  <p>Accepts a message template (a Scheme String), and process it,
  replacing any escape sequences in order with the respective
  values provided after the message template. It is an error if
  more value-requiring escape sequences exist than the number of
  values provided.</p>

  <p>An escape sequence is a two character sequence in the string
  where the first character is a tilde '~'. Each escape code's
  meaning is as follows:</p>

  <ul>
    <li><tt>~a </tt> The corresponding value is inserted into the 
      string as if printed with <tt>display</tt>.</li>
    <li><tt>~s </tt>The corresponding value is inserted into the
      string  as if printed with <tt>write</tt>.</li>
    <li><tt>~% </tt>A newline is inserted.</li>
    <li><tt>~~ </tt>A tilde '~' is inserted.</li>	
  </ul>
</blockquote>
           
<h2>Examples</h2>

<pre>
(format "Hello, ~a" "World!")
; => "Hello, World!"

(format "Error, list is too short: ~s~%" '(one "two" 3))
; => "Error, list is too short: (one \"two\" 3))"
</pre>
               
    <H1>Implementation</H1>
    
    The implementation below requires SRFI-6 (Basic String Ports) 
    for  its implementation of <tt>format</tt>.
    <br>

    <pre>
(define format
  (letrec ((make-format
            (lambda (f-l objects sb)
              (cond ((null? f-l) (get-output-string sb))
                    ((eq? (car f-l) #\~)
                     (begin
		       (case (cadr f-l)
                         ((#\s) (write (car objects) sb))
                         ((#\a) (display (car objects) sb))
                         ((#\%) (display #\newline sb))
                         ((#\~) (display #\~ sb)))
                       (make-format (cddr f-l) (if (not (null? objects))
                                                   (cdr objects) ())
                                    sb)))
                    (else (begin
                            (display (car f-l) sb)
                            (make-format (cdr f-l) objects sb)))))))
    (lambda (format-string . objects)
      (make-format (string->list format-string)
                   objects (open-output-string)))))
    </pre>

    <H1>Copyright</H1>
    Copyright (C) Scott G. Miller (2002). All Rights Reserved.   

    <p>
      This document and translations of it may be copied and furnished
      to others, and derivative works that comment on or otherwise
      explain it or assist in its implementation may be prepared,
      copied, published and distributed, in whole or in part, without
      restriction of any kind, provided that the above copyright
      notice and this paragraph are included on all such copies and
      derivative works. However, this document itself may not be
      modified in any way, such as by removing the copyright notice or
      references to the Scheme Request For Implementation process or
      editors, except as needed for the purpose of developing SRFIs in
      which case the procedures for copyrights defined in the SRFI
      process must be followed, or as required to translate it into
      languages other than English.
    <p>
      The limited permissions granted above are perpetual and will not
      be revoked by the authors or their successors or assigns.
    <p>
      This document and the information contained herein is provided
      on an "AS IS" basis and THE AUTHOR AND THE SRFI EDITORS DISCLAIM
      ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO
      ANY WARRANTY THAT THE USE OF THE INFORMATION HEREIN WILL NOT
      INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF MERCHANTABILITY
      OR FITNESS FOR A PARTICULAR PURPOSE.

    <hr>
    <address>Editor: <a href="mailto:srfi-editors@srfi.schemers.org">Francisco Solsona</a></address>
    <address>Author: <a href="mailto:scgmille@freenetproject.org">Scott G. Miller</a></address>
<!-- Created: Tue Sep 29 19:20:08 EDT 1998 -->
<!-- Revised: Friday, March 22, 2002  19:20 PST  -->
<!-- hhmts start -->
Last modified: Fri Mar 22 21:42:49 CST 2002
<!-- hhmts end -->
  </body>
</html>
